/**
 * Language Switcher for Normand PLLC Website
 * Handles switching between English and Hebrew versions
 */

(function() {
    'use strict';

    // Language switcher initialization
    function initLanguageSwitcher() {
        // Create language switcher HTML
        const switcher = createLanguageSwitcher();

        // Insert into header
        insertIntoHeader(switcher);

        // Bind events
        bindEvents();

        // Update active state
        updateActiveLanguage();
    }

    // Create the language switcher element (Option 1: Minimal Text Switcher)
    function createLanguageSwitcher() {
        const switcher = document.createElement('div');
        switcher.className = 'language-switcher';
        switcher.innerHTML = `
            <div class="lang-switch-minimal">
                <button class="lang-btn" data-lang="en" aria-label="Switch to English">
                    EN
                </button>
                <span class="lang-separator">/</span>
                <button class="lang-btn" data-lang="he" aria-label="Switch to Hebrew">
                    עב
                </button>
            </div>
        `;
        return switcher;
    }

    // Insert switcher into header
    function insertIntoHeader() {
        const header = document.getElementById('masthead');
        const navigation = document.getElementById('site-navigation');

        if (header && navigation) {
            // Create container for switcher
            const container = document.createElement('div');
            container.className = 'language-switcher-container';

            // Add the switcher
            const switcher = createLanguageSwitcher();
            container.appendChild(switcher);

            // Insert before navigation
            header.insertBefore(container, navigation);
        }
    }

    // Bind click events to language buttons
    function bindEvents() {
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('lang-btn')) {
                e.preventDefault();
                const targetLang = e.target.getAttribute('data-lang');
                switchLanguage(targetLang);
            }
        });
    }

    // Switch to specified language
    function switchLanguage(targetLang) {
        const currentPath = window.location.pathname;
        const currentLang = getCurrentLanguage();

        if (currentLang === targetLang) {
            return; // Already on this language
        }

        let newPath;

        if (targetLang === 'he') {
            // Switch to Hebrew
            if (currentPath === '/' || currentPath === '/index.html') {
                newPath = '/index.he.html';
            } else {
                // Add .he before .html
                newPath = currentPath.replace('.html', '.he.html');
                // Handle paths without .html
                if (!newPath.includes('.he.html')) {
                    newPath = currentPath.replace(/\/$/, '') + '/index.he.html';
                }
            }
        } else {
            // Switch to English
            if (currentPath.includes('.he.html')) {
                newPath = currentPath.replace('.he.html', '.html');
            } else {
                newPath = currentPath.replace('/index.he.html', '/index.html');
            }
        }

        // Navigate to new page
        window.location.href = newPath;
    }

    // Get current language from URL
    function getCurrentLanguage() {
        const path = window.location.pathname;
        return path.includes('.he.html') ? 'he' : 'en';
    }

    // Update active state of language buttons
    function updateActiveLanguage() {
        const currentLang = getCurrentLanguage();
        const buttons = document.querySelectorAll('.lang-btn');

        buttons.forEach(btn => {
            if (btn.getAttribute('data-lang') === currentLang) {
                btn.classList.add('active');
            } else {
                btn.classList.remove('active');
            }
        });
    }

    // Initialize when DOM is ready
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initLanguageSwitcher);
    } else {
        initLanguageSwitcher();
    }

    // Update active state after potential navigation
    window.addEventListener('load', updateActiveLanguage);

})();